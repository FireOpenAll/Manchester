<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- Copyright 2009-2012 the original author or authors. Licensed under the 
	Apache License, Version 2.0 (the "License"); you may not use this file except 
	in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 
	Unless required by applicable law or agreed to in writing, software distributed 
	under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES 
	OR CONDITIONS OF ANY KIND, either express or implied. See the License for 
	the specific language governing permissions and limitations under the License. -->

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.galaxy.dal.activity.mapper.ActivityLikedUsersMapper"> 
	<resultMap type="activityLikedUsers" id="ACTIVITY_LIKED_USERS_MAP">
		<id property="id" column="id" />
		<result property="createdTime" column="created_time" />
		<result property="userId" column="user_id" />
		<result property="activityId" column="activity_id" />
	</resultMap>
	<select id="getById" resultMap="ACTIVITY_LIKED_USERS_MAP"
		parameterType="long">
		SELECT *
		FROM ac_activity_liked_users
		WHERE id = #{id}
	</select>
	<!-- 列出某个活动点赞的所有用户 -->
	<select id="listAllLikedUsers" resultMap="ACTIVITY_LIKED_USERS_MAP"
		parameterType="long">
		SELECT *
		FROM ac_activity_liked_users
		WHERE activity_id = #{activity_id}
	</select>
	<!-- 分页列出某个活动点赞的用户 ,param1.map.key=activity_id -->
	<select id="listAllLikedUsersByActId" resultMap="ACTIVITY_LIKED_USERS_MAP"
		parameterType="long">
		SELECT *
		FROM ac_activity_liked_users
		WHERE activity_id = #{param1.activity_id} limit #{param2},#{param3}
	</select> 

	<!-- 分页获取userId评论过的活动 -->
	<select id="getUserLikeedActByUntilId" resultMap="ACTIVITY_LIKED_USERS_MAP">
	select *
	from ac_activity_liked_users
	where user_id = #{userId} and activity_id &gt;  #{untilId} 
	group by activity_id 
	order by activity_id asc
	limit #{pageSize}
	</select>



    <!-- 点赞某活动 -->
	<insert id="insert" parameterType="activityLikedUsers"
		useGeneratedKeys="true" keyProperty="id">
		INSERT INTO
		ac_activity_liked_users(created_time,user_id,activity_id)
		VALUES(#{createdTime},#{userId},#{activityId})
	</insert>
	
	<!-- 取消点赞 -->
	<delete id="cancelLiked">
	drop from ac_activity_liked_users
	where user_id = #{user_id}
	and activity_id = #{activity_id}
	</delete>
	
	<!-- 计算user_id Liked的活动数 -->
	<select id="getLikedActNumByUserId" parameterType="long">
	select count(*) 
	from ac_activity_liked_users
	where user_id = #{user_id}
	</select>
	
	<!-- get by user_id and activity_id -->
	<select id="getByUserIdActId" resultMap="ACTIVITY_LIKED_USERS_MAP">
	select * 
	from ac_activity_liked_users
	where user_id = #{user_id} and activity_id = #{activity_id}
	limit 1
	</select>
</mapper>
